<!DOCTYPE html>

<html>
<head>
  <title>Doxxo</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>Doxxo</h1>
<p>A quick-and-dirty documentation generator inspired by <a href="http://jashkenas.github.com/docco/">Docco</a>. Unlike Docco, Doxxo parses block-level comments to find documentation, leaving inline comments where they belong.</p><p>This file is mostly a direct translation of the <a href="https://github.com/jashkenas/docco/blob/c95b417df9adca5bae029b20ea7499cc28739275/docco.litcoffee">Docco source</a>, which is licensed under MIT.</p><pre><code>Copyright (c) 2009-2013 Jeremy Ashkenas  
Copyright (c) 2014 Beneath the Ink, Inc.  
MIT License
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">// dependencies</span>
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>),
    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>),
    path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>),
    marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>),
    commander = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>),
    highlightjs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>),
    dox = <span class="hljs-built_in">require</span>(<span class="hljs-string">"dox"</span>);

<span class="hljs-comment">// default option values</span>
<span class="hljs-keyword">var</span> defaults = {
    layout:     <span class="hljs-string">'parallel'</span>,
    output:     <span class="hljs-string">'docs'</span>,
    template:   <span class="hljs-literal">null</span>,
    css:        <span class="hljs-literal">null</span>,
    marked:     <span class="hljs-literal">null</span>
};

<span class="hljs-comment">// export all the methods</span>
<span class="hljs-keyword">var</span> Doxxo = <span class="hljs-built_in">module</span>.exports = {
    version: <span class="hljs-built_in">require</span>(<span class="hljs-string">'../package.json'</span>).version,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>run()</h3>
<p>This defines the interface that Doxxo uses to run from the command line. Options are parsed using <a href="https://github.com/visionmedia/commander.js">Commander</a> and passed to <code>Doxxo.document()</code>.</p><h4>Arguments</h4>
<ul>
<li><strong>args</strong> <em>array; optional</em> - An array of command line arguments to parse for options. Defaults to <code>process.argv</code>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    run: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">(args)</span> </span>{
        args = args || process.argv;
        
        commander.version(Doxxo.version)
            .usage(<span class="hljs-string">'[options] files'</span>)
            .option(<span class="hljs-string">'-l, --layout [name]'</span>,    <span class="hljs-string">'choose a layout (parallel, linear or classic)'</span>, defaults.layout)
            .option(<span class="hljs-string">'-o, --output [path]'</span>,    <span class="hljs-string">'output to a given folder'</span>, defaults.output)
            .option(<span class="hljs-string">'-c, --css [file]'</span>,       <span class="hljs-string">'use a custom css file'</span>, defaults.css)
            .option(<span class="hljs-string">'-t, --template [file]'</span>,  <span class="hljs-string">'use a custom .jst template'</span>, defaults.template)
            .option(<span class="hljs-string">'-m, --marked [file]'</span>,    <span class="hljs-string">'use custom marked options'</span>, defaults.marked)
            .parse(args)
            .name = <span class="hljs-string">"doxxo"</span>

        <span class="hljs-keyword">if</span> (commander.args.length) Doxxo.document(commander);
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">console</span>.log(commander.helpInformation());
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>document()</h3>
<p>Generates the documentation for our configured source file by copying over static assets, reading all the source files in, splitting them up into prose+code sections, highlighting each file, and printing them out in an HTML template.</p><h4>Arguments</h4>
<ul>
<li><strong>options</strong> <em>object; optional</em> - An object of options to configure this run of Doxxo.<ul>
<li><strong>options.sources</strong> <em>array</em> - An array of paths to JavaScript files, relative to the current working directory.</li>
<li><strong>options.output</strong> <em>string</em> - The path to a folder that generated files will be saved in.</li>
<li><strong>options.layout</strong> <em>string</em> - The name of the built-in layout to use. Valid values are <code>parallel</code>, <code>linear</code>, <code>classic</code> or <code>plain-markdown</code>.</li>
<li><strong>options.marked</strong> <em>object</em> - Options to configure the markdown parser and renderer.</li>
<li><strong>options.template</strong> <em>string</em> - A path to an Underscore style template file.</li>
<li><strong>options.css</strong> <em>string</em> - A path to a CSS file to use for styling.</li>
</ul>
</li>
<li><strong>callback</strong> <em>function; optional</em> - A function that is called when process is complete. If an error occurs, callback will be given the Error object as an argument.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">document</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">document</span><span class="hljs-params">(options, callback)</span> </span>{
        <span class="hljs-keyword">var</span> config = Doxxo.configure(options || {});

        fs.mkdirs(config.output, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (callback == <span class="hljs-literal">null</span>) {
                callback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{ <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err; }
            }

            <span class="hljs-keyword">var</span> files = config.sources.slice();
            nextFile();
            
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copyAsset</span><span class="hljs-params">(file, callback)</span> </span>{
                <span class="hljs-keyword">if</span> (!fs.existsSync(file)) <span class="hljs-keyword">return</span> callback();
                fs.copy(file, path.join(config.output, path.basename(file)), callback);
            }
            
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complete</span><span class="hljs-params">()</span> </span>{
                copyAsset(config.css, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span> </span>{
                    <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> callback(error);
                    <span class="hljs-keyword">if</span> (fs.existsSync(config.public)) <span class="hljs-keyword">return</span> copyAsset(config.public, callback);
                    callback();
                });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextFile</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> source = files.shift();

                fs.readFile(source, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, buffer)</span> </span>{
                    <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> callback(error);

                    <span class="hljs-keyword">var</span> code = buffer.toString();
                    <span class="hljs-keyword">var</span> sections = Doxxo.parse(source, code, config);
                    Doxxo.format(source, sections, config);
                    Doxxo.write(source, sections, config);
                    
                    <span class="hljs-keyword">if</span> (files.length) nextFile();
                    <span class="hljs-keyword">else</span> complete();
                });
            }
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>parse()</h3>
<p>Given a string of source code, parse out each block-level comment and the code that follows it. This is accomplished using <a href="https://github.com/tj/dox">Dox</a>. An individual <em>section</em> is created for each comment and code. Each section is an object with <code>docsText</code> and <code>codeText</code> properties, and eventually <code>docsHtml</code> and <code>codeHtml</code> as well.</p><h4>Arguments</h4>
<ul>
<li><strong>source</strong> <em>string</em> - A path to a JavaScript file.</li>
<li><strong>code</strong> <em>string</em> - A chunk of raw JavaScript source code.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    parse: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span><span class="hljs-params">(source, code)</span> </span>{
        <span class="hljs-keyword">var</span> comments = dox.parseComments(code, { raw: <span class="hljs-literal">true</span> });
        <span class="hljs-keyword">if</span> (!comments.length) <span class="hljs-keyword">return</span> [];

        <span class="hljs-keyword">var</span> lines = code.split(<span class="hljs-string">"\n"</span>);

        <span class="hljs-keyword">var</span> sections = [{
            codeText: lines.slice(<span class="hljs-number">0</span>, comments[<span class="hljs-number">0</span>].line - <span class="hljs-number">1</span>).join(<span class="hljs-string">'\n'</span>),
            docsText: <span class="hljs-string">''</span>
        }];

        <span class="hljs-keyword">var</span> comment, nextComment, codeEnd, code;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; comments.length; i++) {
            comment = comments[i];
            nextComment = comments[i + <span class="hljs-number">1</span>];
            codeEnd = nextComment != <span class="hljs-literal">null</span> ? nextComment.line - <span class="hljs-number">1</span> : lines.length;
            code = lines.slice(comment.codeStart - <span class="hljs-number">1</span>, codeEnd);

            <span class="hljs-comment">// replace tabs with 4 spaces</span>
            code = code.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line)</span> </span>{
                <span class="hljs-keyword">return</span> line.replace(<span class="hljs-regexp">/^\t+/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> </span>{
                    <span class="hljs-keyword">return</span> _.times(m.length, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">"    "</span>; }).join(<span class="hljs-string">""</span>);
                });
            });

            sections.push({
                docsText: comment.description.full,
                codeText: code.join(<span class="hljs-string">"\n"</span>)
            });
        }

        <span class="hljs-keyword">return</span> sections;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>format()</h3>
<p>Parsed sections of code are sent here to be formatted and highlighted. <a href="https://highlightjs.org">Highlight.js</a> is used to highlight the code and the corresponding comments are run through Markdown, using <a href="https://github.com/chjj/marked">Marked</a>.</p><h4>Arguments</h4>
<ul>
<li><strong>source</strong> <em>string</em> - A path to a JavaScript file.</li>
<li><strong>sections</strong> <em>array</em> - An array of sections returned from <code>Doxxo.parse()</code>.</li>
<li><strong>config</strong> <em>object; optional</em> - An object of options to use during formatting.<ul>
<li><strong>config.marked</strong> <em>object</em> - Options to configure the markdown output. This value is passed directly <code>marked()</code>. The default value is <code>{ smartypants: true }</code>.</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    format: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format</span><span class="hljs-params">(source, sections, config)</span> </span>{
        <span class="hljs-keyword">var</span> markedOptions = _.clone(config.marked || { smartypants: <span class="hljs-literal">true</span> });

        _.defaults(markedOptions, {
            highlight: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, lang)</span> </span>{
                <span class="hljs-keyword">if</span> (highlightjs.getLanguage(lang)) {
                    <span class="hljs-keyword">return</span> highlightjs.highlight(lang, code).value;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> code;
                }
            }
        });

        _.each(sections, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(section)</span> </span>{
            <span class="hljs-keyword">var</span> code = highlightjs.highlight(<span class="hljs-string">"javascript"</span>, section.codeText).value;
            code = code.replace(<span class="hljs-regexp">/\s+$/</span>, <span class="hljs-string">''</span>);
            section.codeHtml = <span class="hljs-string">"&lt;div class='highlight'&gt;&lt;pre&gt;"</span> + code + <span class="hljs-string">"&lt;/pre&gt;&lt;/div&gt;"</span>;
            section.docsHtml = marked(section.docsText, markedOptions);
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3>write()</h3>
<p>Once all of the code has finished highlighting, the resulting documentation file is written by passing the completed HTML sections into the template, and rendering it to the specified output path.</p><p>The title of the file is either the first heading in the prose, or the name of the source file.</p><h4>Arguments</h4>
<ul>
<li><strong>source</strong> <em>string</em> - A path to a JavaScript file.</li>
<li><strong>sections</strong> <em>array</em> - An array of sections returned from <code>Doxxo.parse()</code>.</li>
<li><strong>config</strong> <em>object; optional</em> - An object of options to use during writing.<ul>
<li><strong>config.output</strong> <em>string</em> - The path to a folder, relative to the current working directory, that generated files will be saved to.</li>
<li><strong>config.template</strong> <em>function</em> - A function that should produce HTML when executed. It is given various data needed to generate the content. Follows the same API as functions outputted from <code>_.template()</code>.</li>
<li><strong>config.css</strong> <em>string</em> - The name of the css file to reference in the HTML <code>&lt;head&gt;</code>.</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span><span class="hljs-params">(source, sections, config)</span> </span>{
        <span class="hljs-keyword">var</span> firstSection, first, hasTitle, html;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destination</span><span class="hljs-params">(file)</span> </span>{
            <span class="hljs-keyword">return</span> path.join(config.output, path.basename(file, path.extname(file)) + <span class="hljs-string">'.html'</span>);
        }

        firstSection = _.find(sections, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(section)</span> </span>{
            <span class="hljs-keyword">return</span> section.docsText.length &gt; <span class="hljs-number">0</span>
        });

        <span class="hljs-keyword">if</span> (firstSection) first = marked.lexer(firstSection.docsText)[<span class="hljs-number">0</span>];
        hasTitle = first &amp;&amp; first.type === <span class="hljs-string">'heading'</span> &amp;&amp; first.depth === <span class="hljs-number">1</span>;

        html = config.template({
            sources: config.sources,
            css: path.basename(config.css),
            title: hasTitle ? first.text : path.basename(source),
            hasTitle: hasTitle,
            sections: sections,
            path: path,
            destination: destination
        });

        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"doxxo: %s -&gt; %s"</span>, source, destination(source));
        fs.writeFileSync(destination(source), html);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3>configure()</h3>
<p>This methods parses options given to Doxxo. We might use a passed-in external template, or one of the built-in <em>layouts</em>.</p><p>The user is able to override the layout file used with the <code>--template</code> parameter. In this case, it is also necessary to explicitly specify a stylesheet file. These custom templates are compiled exactly like the predefined ones, but the <code>public</code> folder is only copied for the latter.</p><h4>Arguments</h4>
<ul>
<li><strong>options</strong> <em>object</em> - An object of options to configure this run of Doxxo.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configure</span><span class="hljs-params">(options)</span> </span>{
        <span class="hljs-keyword">var</span> config = _.extend({}, defaults, _.pick(options, _.keys(defaults)));

        <span class="hljs-keyword">if</span> (options.template) {
            <span class="hljs-keyword">if</span> (!options.css) <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">"docco: no stylesheet file specified"</span>);
            config.layout = <span class="hljs-literal">null</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> dir = config.layout = path.resolve(__dirname, <span class="hljs-string">'../layouts'</span>, config.layout);
            <span class="hljs-keyword">if</span> (fs.existsSync(path.join(dir, <span class="hljs-string">'public'</span>))) config.public = path.join(dir, <span class="hljs-string">'public'</span>);
            config.template = path.join(dir, <span class="hljs-string">'docco.jst'</span>);
            config.css = options.css || path.join(dir, <span class="hljs-string">'docco.css'</span>);
        }

        config.template = _.template(fs.readFileSync(config.template).toString());

        <span class="hljs-keyword">if</span> (options.marked) {
            config.marked = _.isString(options.marked) ? <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(options.marked)) : options.marked;
        }

        config.sources = options.args.sort();

        <span class="hljs-keyword">return</span> config;
    }
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
